<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#050508">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>SIGNAL ‚Äî Analiza lo que realmente significa</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #050508;
  --surface: #0d0d14;
  --card: #13131e;
  --border: rgba(255,255,255,0.07);
  --accent: #7c5cfc;
  --accent2: #fc5c7d;
  --gold: #f5c842;
  --text: #f0f0f8;
  --muted: #6b6b8a;
  --success: #3dffa0;
  --danger: #ff4d6d;
  --warning: #ffb347;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* GRAIN OVERLAY */
body::before {
  content:'';
  position:fixed;
  inset:0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events:none;
  z-index:9999;
  opacity:0.4;
}

/* ANIMATED BACKGROUND */
.bg-glow {
  position: fixed;
  width: 600px; height: 600px;
  border-radius: 50%;
  filter: blur(120px);
  pointer-events: none;
  z-index: 0;
}
.bg-glow-1 {
  background: rgba(124,92,252,0.12);
  top: -200px; left: -200px;
  animation: drift1 12s ease-in-out infinite;
}
.bg-glow-2 {
  background: rgba(252,92,125,0.08);
  bottom: -200px; right: -200px;
  animation: drift2 15s ease-in-out infinite;
}
@keyframes drift1 {
  0%,100% { transform: translate(0,0); }
  50% { transform: translate(80px, 60px); }
}
@keyframes drift2 {
  0%,100% { transform: translate(0,0); }
  50% { transform: translate(-60px, -80px); }
}

/* LAYOUT */
.app {
  position: relative;
  z-index: 1;
  max-width: 480px;
  margin: 0 auto;
  padding: 0 16px 40px;
  min-height: 100vh;
}

/* HEADER */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 0 8px;
}
.logo {
  font-family: 'Syne', sans-serif;
  font-weight: 800;
  font-size: 1.3rem;
  letter-spacing: 3px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.credits-badge {
  display: flex;
  align-items: center;
  gap: 6px;
  background: rgba(124,92,252,0.12);
  border: 1px solid rgba(124,92,252,0.25);
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  color: #a89af0;
  cursor: pointer;
}
.credits-dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: var(--success);
  box-shadow: 0 0 8px var(--success);
  animation: blink 2s ease-in-out infinite;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.4} }

/* HERO */
.hero {
  padding: 32px 0 24px;
  animation: fadeUp 0.6s ease both;
}
@keyframes fadeUp {
  from { opacity:0; transform:translateY(20px); }
  to { opacity:1; transform:translateY(0); }
}
.hero-tag {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: rgba(245,200,66,0.1);
  border: 1px solid rgba(245,200,66,0.2);
  color: var(--gold);
  font-size: 0.72rem;
  font-weight: 500;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  padding: 5px 12px;
  border-radius: 20px;
  margin-bottom: 16px;
}
.hero h1 {
  font-family: 'Syne', sans-serif;
  font-size: 2rem;
  font-weight: 800;
  line-height: 1.15;
  margin-bottom: 10px;
}
.hero h1 span {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.hero p {
  color: var(--muted);
  font-size: 0.95rem;
  line-height: 1.6;
}

/* CONTEXT SELECTOR */
.context-label {
  font-size: 0.75rem;
  font-weight: 500;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 10px;
}
.context-pills {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}
.pill {
  padding: 7px 14px;
  border-radius: 20px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--muted);
  font-size: 0.82rem;
  cursor: pointer;
  transition: all 0.2s;
  user-select: none;
}
.pill:hover { border-color: rgba(124,92,252,0.4); color: var(--text); }
.pill.active {
  background: rgba(124,92,252,0.15);
  border-color: var(--accent);
  color: var(--accent);
  font-weight: 500;
}

/* TEXTAREA */
.input-container {
  position: relative;
  margin-bottom: 16px;
}
.chat-input {
  width: 100%;
  min-height: 160px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 16px;
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 0.9rem;
  line-height: 1.6;
  resize: none;
  outline: none;
  transition: border-color 0.2s;
}
.chat-input:focus { border-color: rgba(124,92,252,0.5); }
.chat-input::placeholder { color: var(--muted); }
.char-count {
  position: absolute;
  bottom: 10px; right: 14px;
  font-size: 0.72rem;
  color: var(--muted);
}

/* MAIN BUTTON */
.btn-analyze {
  width: 100%;
  padding: 18px;
  background: linear-gradient(135deg, var(--accent), #6040e0);
  border: none;
  border-radius: 14px;
  color: white;
  font-family: 'Syne', sans-serif;
  font-size: 1rem;
  font-weight: 700;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}
.btn-analyze::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.15), transparent);
  opacity: 0;
  transition: opacity 0.3s;
}
.btn-analyze:hover::before { opacity: 1; }
.btn-analyze:hover { transform: translateY(-1px); box-shadow: 0 8px 30px rgba(124,92,252,0.4); }
.btn-analyze:active { transform: translateY(0); }
.btn-analyze:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

.free-counter {
  text-align: center;
  font-size: 0.78rem;
  color: var(--muted);
  margin-top: 10px;
}
.free-counter span { color: var(--accent); font-weight: 500; }

/* LOADING */
.loading-screen {
  display: none;
  padding: 48px 0;
  text-align: center;
  animation: fadeUp 0.3s ease both;
}
.loading-screen.active { display: block; }
.loading-orb {
  width: 64px; height: 64px;
  margin: 0 auto 24px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  animation: pulse-orb 1.5s ease-in-out infinite;
  box-shadow: 0 0 40px rgba(124,92,252,0.5);
}
@keyframes pulse-orb {
  0%,100% { transform: scale(1); box-shadow: 0 0 40px rgba(124,92,252,0.5); }
  50% { transform: scale(1.1); box-shadow: 0 0 60px rgba(124,92,252,0.8); }
}
.loading-steps {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 20px;
}
.loading-step {
  font-size: 0.82rem;
  color: var(--muted);
  opacity: 0;
  transition: opacity 0.4s, color 0.4s;
}
.loading-step.done { opacity: 1; color: var(--success); }
.loading-step.active { opacity: 1; color: var(--text); animation: shimmer 1s ease-in-out infinite; }
@keyframes shimmer { 0%,100%{opacity:1} 50%{opacity:0.6} }

/* RESULTS */
.results-screen {
  display: none;
  animation: fadeUp 0.5s ease both;
}
.results-screen.active { display: block; }

.result-header {
  padding: 20px 0 16px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 20px;
}
.result-context-tag {
  font-size: 0.72rem;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 6px;
}
.result-title {
  font-family: 'Syne', sans-serif;
  font-size: 1.3rem;
  font-weight: 700;
}

/* RESULT BLOCKS */
.result-block {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 12px;
  animation: fadeUp 0.4s ease both;
}
.result-block:nth-child(1) { animation-delay: 0.1s; }
.result-block:nth-child(2) { animation-delay: 0.2s; }
.result-block:nth-child(3) { animation-delay: 0.3s; }
.result-block:nth-child(4) { animation-delay: 0.4s; }
.result-block:nth-child(5) { animation-delay: 0.5s; }

.block-label {
  font-size: 0.68rem;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.block-number {
  width: 18px; height: 18px;
  border-radius: 50%;
  background: rgba(124,92,252,0.2);
  color: var(--accent);
  font-size: 0.65rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
}
.block-content {
  font-size: 1rem;
  line-height: 1.5;
  font-weight: 500;
}

/* INTEREST BAR */
.interest-bar-container {
  margin-top: 10px;
}
.interest-bar-bg {
  height: 8px;
  background: rgba(255,255,255,0.06);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 6px;
}
.interest-bar-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 1s cubic-bezier(0.4,0,0.2,1);
  background: linear-gradient(90deg, var(--accent), var(--accent2));
}
.interest-percent {
  font-family: 'Syne', sans-serif;
  font-size: 2rem;
  font-weight: 800;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* RISK BADGE */
.risk-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
  margin-top: 4px;
}
.risk-bajo { background: rgba(61,255,160,0.1); color: var(--success); border: 1px solid rgba(61,255,160,0.2); }
.risk-medio { background: rgba(255,179,71,0.1); color: var(--warning); border: 1px solid rgba(255,179,71,0.2); }
.risk-alto { background: rgba(255,77,109,0.1); color: var(--danger); border: 1px solid rgba(255,77,109,0.2); }

/* COPY MESSAGE BLOCK */
.message-block {
  background: rgba(124,92,252,0.06);
  border: 1px solid rgba(124,92,252,0.2);
  border-radius: 12px;
  padding: 14px 16px;
  font-size: 0.9rem;
  line-height: 1.6;
  color: #d4ccff;
  margin-top: 8px;
  position: relative;
  font-style: italic;
}
.btn-copy {
  width: 100%;
  margin-top: 10px;
  padding: 12px;
  background: rgba(124,92,252,0.12);
  border: 1px solid rgba(124,92,252,0.25);
  border-radius: 10px;
  color: var(--accent);
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}
.btn-copy:hover { background: rgba(124,92,252,0.2); }
.btn-copy.copied { background: rgba(61,255,160,0.1); color: var(--success); border-color: rgba(61,255,160,0.25); }

/* PREMIUM BLOCK */
.premium-block {
  background: var(--card);
  border: 1px solid rgba(245,200,66,0.2);
  border-radius: 16px;
  overflow: hidden;
  margin-bottom: 12px;
  position: relative;
  animation: fadeUp 0.4s ease 0.6s both;
}
.premium-blur {
  padding: 20px;
  filter: blur(6px);
  user-select: none;
  pointer-events: none;
}
.premium-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: linear-gradient(to bottom, transparent, rgba(13,13,20,0.95));
  padding: 20px;
  text-align: center;
}
.lock-icon {
  font-size: 1.8rem;
  margin-bottom: 8px;
}
.premium-title {
  font-family: 'Syne', sans-serif;
  font-size: 0.9rem;
  font-weight: 700;
  color: var(--gold);
  margin-bottom: 4px;
}
.premium-features {
  font-size: 0.75rem;
  color: var(--muted);
  margin-bottom: 16px;
  line-height: 1.6;
}
.btn-unlock {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, #f5c842, #f09d10);
  border: none;
  border-radius: 12px;
  color: #1a1400;
  font-family: 'Syne', sans-serif;
  font-size: 0.9rem;
  font-weight: 800;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 0.3s;
}
.btn-unlock:hover { transform: translateY(-1px); box-shadow: 0 8px 25px rgba(245,200,66,0.3); }

/* URGENCY COUNTER */
.urgency-bar {
  display: flex;
  align-items: center;
  gap: 10px;
  background: rgba(255,77,109,0.08);
  border: 1px solid rgba(255,77,109,0.15);
  border-radius: 10px;
  padding: 10px 14px;
  margin-bottom: 16px;
  font-size: 0.8rem;
  color: #ff8099;
  animation: fadeUp 0.4s ease 0.7s both;
}
.urgency-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: var(--danger);
  box-shadow: 0 0 8px var(--danger);
  animation: blink 1s ease-in-out infinite;
  flex-shrink: 0;
}

/* NEW ANALYSIS BUTTON */
.btn-new {
  width: 100%;
  padding: 16px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  color: var(--muted);
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 8px;
  font-family: 'DM Sans', sans-serif;
}
.btn-new:hover { border-color: rgba(255,255,255,0.15); color: var(--text); }

/* PAYMENT MODAL */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(5,5,8,0.85);
  z-index: 1000;
  align-items: flex-end;
  justify-content: center;
  backdrop-filter: blur(8px);
}
.modal-overlay.active { display: flex; }
.modal {
  width: 100%;
  max-width: 480px;
  background: var(--surface);
  border-radius: 24px 24px 0 0;
  border-top: 1px solid var(--border);
  padding: 28px 24px 40px;
  animation: slideUp 0.4s cubic-bezier(0.4,0,0.2,1);
}
@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}
.modal-handle {
  width: 36px; height: 4px;
  background: rgba(255,255,255,0.1);
  border-radius: 2px;
  margin: 0 auto 24px;
}
.modal-title {
  font-family: 'Syne', sans-serif;
  font-size: 1.4rem;
  font-weight: 800;
  margin-bottom: 6px;
}
.modal-subtitle {
  color: var(--muted);
  font-size: 0.9rem;
  margin-bottom: 24px;
}
.plan-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 18px;
  margin-bottom: 12px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.plan-card:hover, .plan-card.selected {
  border-color: var(--accent);
  background: rgba(124,92,252,0.08);
}
.plan-card.featured {
  border-color: var(--gold);
  background: rgba(245,200,66,0.05);
}
.plan-name { font-weight: 600; font-size: 0.95rem; margin-bottom: 2px; }
.plan-desc { font-size: 0.78rem; color: var(--muted); }
.plan-price {
  font-family: 'Syne', sans-serif;
  font-size: 1.2rem;
  font-weight: 800;
  color: var(--gold);
  text-align: right;
}
.plan-period { font-size: 0.7rem; color: var(--muted); }
.btn-pay {
  width: 100%;
  padding: 18px;
  background: linear-gradient(135deg, #f5c842, #f09d10);
  border: none;
  border-radius: 14px;
  color: #1a1400;
  font-family: 'Syne', sans-serif;
  font-size: 1rem;
  font-weight: 800;
  cursor: pointer;
  margin-top: 16px;
  transition: all 0.3s;
}
.btn-pay:hover { transform: translateY(-1px); box-shadow: 0 8px 30px rgba(245,200,66,0.3); }
.modal-close {
  width: 100%;
  padding: 14px;
  background: transparent;
  border: none;
  color: var(--muted);
  font-size: 0.85rem;
  cursor: pointer;
  margin-top: 8px;
}
.secure-tag {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  font-size: 0.72rem;
  color: var(--muted);
  margin-top: 12px;
}

/* TOAST */
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 20px;
  font-size: 0.85rem;
  z-index: 9000;
  transition: transform 0.3s ease;
  white-space: nowrap;
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* HIDDEN */
.hidden { display: none !important; }
</style>
</head>
<body>

<div class="bg-glow bg-glow-1"></div>
<div class="bg-glow bg-glow-2"></div>

<div class="app">

  <!-- HEADER -->
  <div class="header">
    <div class="logo">SIGNAL</div>
    <div class="credits-badge">
      <div class="credits-dot"></div>
      <span id="credits-label">3 gratis hoy</span>
    </div>
  </div>

  <!-- MAIN INPUT SCREEN -->
  <div id="screen-input">
    <div class="hero">
      <div class="hero-tag">‚ö° Motor de decisi√≥n social</div>
      <h1>Analiza lo que <span>realmente</span> significa</h1>
      <p>Pega cualquier conversaci√≥n y obt√©n un diagn√≥stico t√°ctico en segundos.</p>
    </div>

    <div class="context-label">¬øQu√© tipo de relaci√≥n?</div>
    <div class="context-pills">
      <div class="pill active" data-ctx="pareja">üíë Pareja</div>
      <div class="pill" data-ctx="cita">üî• Cita</div>
      <div class="pill" data-ctx="amistad">üë• Amistad</div>
      <div class="pill" data-ctx="trabajo">üíº Trabajo</div>
      <div class="pill" data-ctx="negociacion">ü§ù Negociaci√≥n</div>
    </div>

    <div class="input-container">
      <textarea 
        class="chat-input" 
        id="chat-input"
        placeholder="Pega aqu√≠ la conversaci√≥n...&#10;&#10;Ejemplo:&#10;‚Äî √âl: ¬øQuedamos el viernes?&#10;‚Äî Yo: Puede ser...&#10;‚Äî √âl: Ok, ya te digo"
        maxlength="3000"
        oninput="updateCharCount()"
      ></textarea>
      <div class="char-count"><span id="char-count">0</span>/3000</div>
    </div>

    <button class="btn-analyze" id="btn-analyze" onclick="startAnalysis()">
      ANALIZAR CONVERSACI√ìN
    </button>
    <div class="free-counter">
      <span id="free-remaining">3</span> an√°lisis gratis restantes hoy
    </div>
  </div>

  <!-- LOADING SCREEN -->
  <div id="screen-loading" class="loading-screen">
    <div class="loading-orb"></div>
    <div style="font-family:'Syne',sans-serif; font-size:1.1rem; font-weight:700; margin-bottom:6px;">Procesando se√±ales...</div>
    <div style="color:var(--muted); font-size:0.85rem; margin-bottom:24px;">An√°lisis t√°ctico en curso</div>
    <div class="loading-steps">
      <div class="loading-step" id="step-1">‚¨° Escaneando patrones ling√º√≠sticos</div>
      <div class="loading-step" id="step-2">‚¨° Detectando intenci√≥n real</div>
      <div class="loading-step" id="step-3">‚¨° Calculando nivel de inter√©s</div>
      <div class="loading-step" id="step-4">‚¨° Generando diagn√≥stico</div>
    </div>
  </div>

  <!-- RESULTS SCREEN -->
  <div id="screen-results" class="results-screen">
    
    <div class="result-header">
      <div class="result-context-tag" id="result-context-tag">AN√ÅLISIS ‚Ä¢ PAREJA</div>
      <div class="result-title">Diagn√≥stico completado</div>
    </div>

    <!-- BLOCK 1: INTENCI√ìN REAL -->
    <div class="result-block">
      <div class="block-label">
        <div class="block-number">1</div>
        Intenci√≥n real de la otra persona
      </div>
      <div class="block-content" id="r-intencion">‚Äî</div>
    </div>

    <!-- BLOCK 2: NIVEL DE INTER√âS -->
    <div class="result-block">
      <div class="block-label">
        <div class="block-number">2</div>
        Nivel de inter√©s
      </div>
      <div class="interest-percent" id="r-interes-num">0%</div>
      <div class="interest-bar-container">
        <div class="interest-bar-bg">
          <div class="interest-bar-fill" id="r-interes-bar" style="width:0%"></div>
        </div>
      </div>
    </div>

    <!-- BLOCK 3: RIESGO -->
    <div class="result-block">
      <div class="block-label">
        <div class="block-number">3</div>
        Riesgo de rechazo
      </div>
      <div id="r-riesgo-badge">‚Äî</div>
    </div>

    <!-- BLOCK 4: QU√â HACER -->
    <div class="result-block">
      <div class="block-label">
        <div class="block-number">4</div>
        Qu√© hacer ahora
      </div>
      <div class="block-content" id="r-accion">‚Äî</div>
    </div>

    <!-- BLOCK 5: MENSAJE -->
    <div class="result-block">
      <div class="block-label">
        <div class="block-number">5</div>
        Mensaje recomendado
      </div>
      <div class="message-block" id="r-mensaje">‚Äî</div>
      <button class="btn-copy" id="btn-copy" onclick="copyMessage()">
        üìã Copiar mensaje
      </button>
    </div>

    <!-- URGENCY BAR -->
    <div class="urgency-bar">
      <div class="urgency-dot"></div>
      <span id="urgency-text">El tiempo de respuesta √≥ptimo es ahora. Despu√©s de 3h, el contexto cambia.</span>
    </div>

    <!-- WHATSAPP CONTACT BLOCK -->
    <div style="background: linear-gradient(135deg, rgba(37,211,102,0.08), rgba(37,211,102,0.03)); border: 1px solid rgba(37,211,102,0.2); border-radius: 16px; padding: 22px; margin-bottom: 12px; text-align: center; animation: fadeUp 0.4s ease 0.6s both;">
      <div style="font-size: 1.8rem; margin-bottom: 10px;">üéØ</div>
      <div style="font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 700; color: #3dffa0; margin-bottom: 8px;">¬øQuieres un an√°lisis m√°s profundo?</div>
      <div style="font-size: 0.85rem; color: var(--muted); margin-bottom: 16px; line-height: 1.6;">
        Este an√°lisis es autom√°tico. Si necesitas una lectura personalizada, estrategia completa o acompa√±amiento real, escr√≠beme directamente.
      </div>
      <a href="https://wa.me/34672680535?text=Hola%2C%20he%20usado%20SIGNAL%20y%20me%20gustar%C3%ADa%20un%20an%C3%A1lisis%20m%C3%A1s%20profundo%20de%20mi%20situaci%C3%B3n." 
         target="_blank"
         style="display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; padding: 15px; background: #25D366; border: none; border-radius: 12px; color: white; font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 700; cursor: pointer; text-decoration: none; transition: all 0.3s;">
        üì± Acceder aqu√≠ ¬∑ 672 680 535
      </a>
    </div>

    <button class="btn-new" onclick="newAnalysis()">
      ‚Ü© Nuevo an√°lisis
    </button>

  </div><!-- end results -->

</div><!-- end app -->

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ==================== STATE ====================
let selectedContext = 'pareja';
let freeAnalysesLeft = parseInt(localStorage.getItem('signal_free') || '3');
let lastResetDate = localStorage.getItem('signal_date') || '';
let currentMessage = '';
let selectedPlan = 'monthly';

// Reset diario
const today = new Date().toDateString();
if (lastResetDate !== today) {
  freeAnalysesLeft = 3;
  localStorage.setItem('signal_free', '3');
  localStorage.setItem('signal_date', today);
}

updateCreditsUI();

// ==================== UI HELPERS ====================
function updateCharCount() {
  const v = document.getElementById('chat-input').value.length;
  document.getElementById('char-count').textContent = v;
}

function updateCreditsUI() {
  document.getElementById('free-remaining').textContent = freeAnalysesLeft;
  document.getElementById('credits-label').textContent = freeAnalysesLeft + ' gratis hoy';
}

function showScreen(id) {
  ['screen-input','screen-loading','screen-results'].forEach(s => {
    const el = document.getElementById(s);
    if (s === id) {
      el.classList.remove('hidden');
      if (s === 'screen-loading') el.classList.add('active');
      if (s === 'screen-results') el.classList.add('active');
    } else {
      el.classList.add('hidden');
      el.classList.remove('active');
    }
  });
  window.scrollTo(0,0);
}

// ==================== CONTEXT PILLS ====================
document.querySelectorAll('.pill').forEach(pill => {
  pill.addEventListener('click', () => {
    document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
    pill.classList.add('active');
    selectedContext = pill.dataset.ctx;
  });
});

// ==================== LOADING ANIMATION ====================
async function animateLoading() {
  const steps = ['step-1','step-2','step-3','step-4'];
  for (let i = 0; i < steps.length; i++) {
    if (i > 0) document.getElementById(steps[i-1]).classList.remove('active');
    if (i > 0) document.getElementById(steps[i-1]).classList.add('done');
    document.getElementById(steps[i]).classList.add('active');
    await sleep(700 + Math.random() * 400);
  }
  document.getElementById(steps[steps.length-1]).classList.remove('active');
  document.getElementById(steps[steps.length-1]).classList.add('done');
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

// Reset loading steps
function resetLoadingSteps() {
  ['step-1','step-2','step-3','step-4'].forEach(s => {
    document.getElementById(s).classList.remove('active','done');
  });
}

// ==================== MAIN ANALYSIS ====================
async function startAnalysis() {
  const chat = document.getElementById('chat-input').value.trim();
  
  if (!chat || chat.length < 20) {
    showToast('‚ö†Ô∏è Pega una conversaci√≥n v√°lida para analizar');
    return;
  }
  
  if (freeAnalysesLeft <= 0) {
    window.open('https://wa.me/34672680535?text=Hola%2C%20he%20agotado%20mis%20an%C3%A1lisis%20gratis%20en%20SIGNAL%20y%20me%20gustar%C3%ADa%20continuar%20con%20un%20an%C3%A1lisis%20personalizado.', '_blank');
    return;
  }

  // Consume cr√©dito
  freeAnalysesLeft--;
  localStorage.setItem('signal_free', freeAnalysesLeft.toString());
  updateCreditsUI();

  // Context label
  const ctxMap = {
    pareja: 'PAREJA', cita: 'CITA / FLIRTEO',
    amistad: 'AMISTAD', trabajo: 'TRABAJO', negociacion: 'NEGOCIACI√ìN'
  };
  document.getElementById('result-context-tag').textContent = 
    'AN√ÅLISIS ‚Ä¢ ' + (ctxMap[selectedContext] || selectedContext.toUpperCase());

  // Show loading
  resetLoadingSteps();
  showScreen('screen-loading');
  
  // Start loading animation (parallel with API call)
  const loadingPromise = animateLoading();

  try {
    const result = await callAnalysisAPI(chat, selectedContext);
    await loadingPromise;
    await sleep(400);
    renderResults(result);
    showScreen('screen-results');
  } catch (err) {
    await loadingPromise;
    showScreen('screen-input');
    showToast('Error al analizar. Int√©ntalo de nuevo.');
    freeAnalysesLeft++;
    localStorage.setItem('signal_free', freeAnalysesLeft.toString());
    updateCreditsUI();
  }
}

// ==================== API CALL ====================
async function callAnalysisAPI(chat, context) {
  const systemPrompt = `Eres SIGNAL, un motor de an√°lisis t√°ctico de conversaciones sociales. Tu trabajo es analizar conversaciones y dar diagn√≥sticos directos, sin ambig√ºedades. 

REGLAS ABSOLUTAS:
- NUNCA uses "depende", "podr√≠a", "quiz√°s", "tal vez"
- SIEMPRE da una decisi√≥n clara y definitiva
- Tono: analista t√°ctico, no terapeuta
- S√© directo, conciso, contundente
- Responde SOLO con JSON v√°lido, sin texto extra

Contexto de la conversaci√≥n: ${context}

Devuelve EXACTAMENTE este JSON:
{
  "intencion": "frase corta y directa sobre qu√© quiere realmente la otra persona",
  "interes": n√∫mero del 0 al 100,
  "riesgo": "bajo" o "medio" o "alto",
  "accion": "una sola frase concreta de qu√© hacer ahora mismo",
  "mensaje": "texto listo para enviar, natural y efectivo",
  "urgencia": "frase corta sobre el timing √≥ptimo"
}`;

  const response = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model: 'claude-sonnet-4-20250514',
      max_tokens: 1000,
      system: systemPrompt,
      messages: [{ 
        role: 'user', 
        content: `Analiza esta conversaci√≥n de ${context}:\n\n${chat}` 
      }]
    })
  });

  const data = await response.json();
  const text = data.content[0].text.trim();
  
  // Parse JSON (remove any markdown if present)
  const clean = text.replace(/```json|```/g, '').trim();
  return JSON.parse(clean);
}

// ==================== RENDER RESULTS ====================
function renderResults(data) {
  // Intenci√≥n
  document.getElementById('r-intencion').textContent = data.intencion;
  
  // Inter√©s
  const pct = Math.min(100, Math.max(0, data.interes));
  document.getElementById('r-interes-num').textContent = pct + '%';
  setTimeout(() => {
    document.getElementById('r-interes-bar').style.width = pct + '%';
  }, 300);
  
  // Riesgo
  const riskEl = document.getElementById('r-riesgo-badge');
  const riskClass = { bajo: 'risk-bajo', medio: 'risk-medio', alto: 'risk-alto' }[data.riesgo] || 'risk-medio';
  const riskIcon = { bajo: '‚úì', medio: '‚ö†', alto: '‚úó' }[data.riesgo] || '‚ö†';
  const riskLabel = { bajo: 'BAJO', medio: 'MEDIO', alto: 'ALTO' }[data.riesgo] || data.riesgo.toUpperCase();
  riskEl.innerHTML = `<span class="risk-badge ${riskClass}">${riskIcon} Riesgo ${riskLabel}</span>`;
  
  // Acci√≥n
  document.getElementById('r-accion').textContent = data.accion;
  
  // Mensaje
  currentMessage = data.mensaje;
  document.getElementById('r-mensaje').textContent = data.mensaje;
  document.getElementById('btn-copy').classList.remove('copied');
  document.getElementById('btn-copy').textContent = 'üìã Copiar mensaje';
  
  // Urgencia
  if (data.urgencia) {
    document.getElementById('urgency-text').textContent = data.urgencia;
  }
}

// ==================== COPY MESSAGE ====================
function copyMessage() {
  navigator.clipboard.writeText(currentMessage).then(() => {
    const btn = document.getElementById('btn-copy');
    btn.textContent = '‚úì Copiado';
    btn.classList.add('copied');
    showToast('‚úì Mensaje copiado al portapapeles');
    setTimeout(() => {
      btn.textContent = 'üìã Copiar mensaje';
      btn.classList.remove('copied');
    }, 3000);
  });
}

// ==================== NEW ANALYSIS ====================
function newAnalysis() {
  document.getElementById('chat-input').value = '';
  document.getElementById('char-count').textContent = '0';
  showScreen('screen-input');
}

// ==================== MODAL ====================
function showModal() { document.getElementById('modal-overlay').classList.add('active'); }
function closeModal() { document.getElementById('modal-overlay').classList.remove('active'); }
function closeModalOutside(e) {
  if (e.target === document.getElementById('modal-overlay')) closeModal();
}

function selectPlan(el) {
  document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  selectedPlan = el.dataset.plan;
}

function processPayment() {
  // Aqu√≠ conectar con Stripe real
  // window.location.href = 'https://buy.stripe.com/...';
  closeModal();
  showToast('üîí Redirigiendo a pago seguro...');
  setTimeout(() => showToast('‚ÑπÔ∏è Stripe no configurado en esta demo'), 2000);
}

// ==================== TOAST ====================
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}
</script>
</body>
</html>
